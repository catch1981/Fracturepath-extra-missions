<script>
(() => {
  // Path logic
  function basePath(){
    const p = location.pathname;
    return p.endsWith('/') ? p : p.replace(/[^\/]+$/, '');
  }
  const BASE = basePath();
  const HERO_SRC = BASE + "intro.jpg";

  const hero = document.getElementById('hero');
  const heroNext = document.getElementById('heroNext');

  // preload & set hero
  function preload(src){
    return new Promise(res=>{
      const im = new Image();
      im.onload = () => res({ok:true,src});
      im.onerror = () => res({ok:false,src});
      im.src = src;
    });
  }

  preload(HERO_SRC).then(r=>{
    if(r.ok){
      hero.src = HERO_SRC;
      hero.alt = "Hero — Warrior Above the Burning City";
    } else {
      console.warn("⚠️ intro.jpg missing from folder.");
      hero.alt = "⚠️ Missing Hero Image (intro.jpg)";
    }
  });

  // optional crossfade helper if you swap hero later
  function crossfadeHero(nextSrc, nextAlt=""){
    heroNext.src = nextSrc;
    heroNext.alt = nextAlt;
    hero.classList.add('fade-out');
    heroNext.classList.add('fade-in');
    setTimeout(()=>{
      hero.src = nextSrc;
      hero.alt = nextAlt;
      hero.classList.remove('fade-out');
      heroNext.classList.remove('fade-in');
      heroNext.src = "";
    }, 900);
  }

  // expose crossfadeHero globally if needed
  window.crossfadeHero = crossfadeHero;
})();
</script><!DOCTYPE html>
<html lang="en">
<head> 
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coven Zero — The North Witch</title>
  <style>
    :root{
      --bg:#0b0b0e; --bg2:#0f0f16;
      --ink:#e9e9f4; --muted:#a0a5b5;
      --glow:#ff2e9b; --ember:#ff6a00; --ward:#7c4dff;
      --line:#1e1e2a; --line2:#232337;
      --discord:#5865F2;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{
      font-family:ui-sans-serif,system-ui,Segoe UI,Inter,Roboto,Arial;
      background:radial-gradient(1200px 820px at 70% 10%, #1a0f1f 0%, #0b0b0e 60%);
      color:var(--ink);
    }
    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    header,footer{padding:14px 18px;border-bottom:1px solid var(--line)}
    footer{border-top:1px solid var(--line);border-bottom:none;color:#a0a5b5}
    .grid{display:grid;grid-template-columns:1fr min(840px,92vw) 1fr}.center{grid-column:2}
    .sigil{letter-spacing:.12em;font-weight:700;text-transform:uppercase;opacity:.9}
    .sigil .glow{color:var(--glow);text-shadow:0 0 18px #ff2e9b66}
    .tag{font-size:.9rem;color:#a0a5b5}

    .stage{
      position:relative;background:linear-gradient(180deg,#13131b 0%, #0f0f16 100%);
      border:1px solid var(--line2);border-radius:14px;padding:18px;
      box-shadow:0 10px 40px #0008,inset 0 0 0 1px #ffffff08;overflow:hidden
    }
    .rune{position:absolute;right:12px;top:12px;font-weight:800;letter-spacing:.14em;color:#ffffffaa;text-shadow:0 0 10px #ff2e9b55;opacity:.7;pointer-events:none}

    /* hero crossfade */
    .hero-wrap{position:relative;border-radius:10px;overflow:hidden;box-shadow:0 12px 40px #0008;margin-bottom:12px}
    .hero, .hero-next{
      width:100%;max-height:55vh;object-fit:cover;display:block;border-radius:10px;
      position:absolute;left:0;top:0;right:0;bottom:0;opacity:1;transition:opacity .9s ease;
    }
    .hero-next{opacity:0}
    .fade-out{opacity:0}
    .fade-in{opacity:1}

    .bubble{
      margin:16px 0;padding:16px;border:1px solid #24243a;border-radius:12px;
      background:rgba(20,20,29,.55);backdrop-filter:blur(8px);
      opacity:0;transform:translateY(10px);transition:opacity .6s ease, transform .6s ease;
    }
    .bubble.show{opacity:1;transform:none}
    .bubble h2{margin:0 0 6px;font-size:1.15rem}
    .bubble p{margin:.35rem 0 .5rem;color:#cfd0db}

    .opts{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .btn{border:1px solid #2a2a44;background:#141423;color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;transition:all .15s ease}
    .btn:hover{border-color:#3a3a66;transform:translateY(-1px)}
    .btn.primary{border-color:#4b2a5f;background:linear-gradient(180deg,#23122c,#1a1023)}
    .btn.bad{border-color:#5e1d33;background:#1a0f16}
    .btn.ok{border-color:#1c3b2e;background:#0e1a16}
    .btn.discord{border-color:#3f49c9;background:linear-gradient(180deg,#616BFF,#4B57E6)}

    .divider{height:1px;background:linear-gradient(90deg,#0000,#2b2b44,#0000);margin:14px 0}
    .prog{height:6px;border-radius:999px;background:#181828;border:1px solid #26263a;overflow:hidden}
    .prog .bar{height:100%;width:0%;background:linear-gradient(90deg,#7c4dff,#ff2e9b,#ff6a00);transition:width .4s ease}

    /* Interlude: crossfade too */
    .interlude{display:none;position:relative;margin:16px 0;padding:0;border-radius:12px;overflow:hidden;border:1px solid #282844;background:#0c0c14}
    .interlude .frame{position:relative}
    .interlude img{display:block;width:100%;height:auto;object-fit:cover;opacity:0;transition:opacity .9s ease}
    .interlude img.show{opacity:1}
    .interlude .bar{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:10px 12px;border-top:1px solid #282844;background:#11111a}
    .interlude .title{font-weight:700;letter-spacing:.06em}

    @media(max-width:480px){.btn{width:100%}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="grid"><div class="center">
        <div class="sigil">COVEN ZERO • <span class="glow">NORTH WITCH</span> • FIREWALL NODE</div>
        <div class="tag">“The glitch is the plan. The fracture is the doorway. The Witch is the Seal.”</div>
      </div></div>
    </header>

    <main class="grid">
      <section class="center stage" id="stage">
        <div class="rune" aria-hidden="true">⛧⛓</div>

        <!-- HERO CROSSFADE LAYER -->
        <div class="hero-wrap">
          <img id="hero" class="hero" alt="Hero — The Warrior Above the Burning City" />
          <img id="heroNext" class="hero-next" alt="" aria-hidden="true"/>
        </div>

        <!-- WELCOME -->
        <div class="bubble show" id="welcome">
          <h2>Entry Rite</h2>
          <p>The auroras tear like broken code. The <b>North Witch</b> regards you without blinking. 
          <i>“You step into frost and fire — will you walk the rite?”</i></p>
          <div class="opts">
            <button class="btn primary" data-next="mem">Enter Trial</button>
            <button class="btn bad" data-next="flee">Flee</button>
            <a class="btn discord" href="https://discord.gg/u856NrVGjd" target="_blank" rel="noopener noreferrer">Return to Discord</a>
          </div>
        </div>

        <div class="divider"></div>
        <div class="prog" aria-label="progress"><div class="bar" id="bar"></div></div>

        <!-- MEMORY -->
        <div class="bubble" id="mem" style="display:none">
          <h2>Shade of Memory</h2>
          <p>Whispers braid from the ice — every fracture you tried to forget. They press at the walls of your mind like hungry shadows.</p>
          <div class="opts">
            <button class="btn primary" data-score="1" data-interlude="0" data-next="flesh">Confront the voices</button>
            <button class="btn"           data-score="0" data-interlude="0" data-next="flesh">Deny them</button>
          </div>
        </div>

        <!-- FLESH -->
        <div class="bubble" id="flesh" style="display:none">
          <h2>Shade of Flesh</h2>
          <p>The wind compresses your bones. The Witch asks: <i>“What will you surrender to pass?”</i></p>
          <div class="opts">
            <button class="btn primary" data-score="1" data-interlude="1" data-next="fire">Blood</button>
            <button class="btn"           data-score="1" data-interlude="1" data-next="fire">Breath</button>
            <button class="btn"           data-score="0" data-interlude="1" data-next="fire">Silence</button>
          </div>
        </div>

        <!-- FIRE -->
        <div class="bubble" id="fire" style="display:none">
          <h2>Shade of Fire</h2>
          <p>Flame peels away the mask. Only your core remains. The Witch whispers: <i>“Do you burn with the truth — or hide in the ashes?”</i></p>
          <div class="opts">
            <button class="btn ok"  data-score="1" data-interlude="2" data-next="outcome">Accept your truth</button>
            <button class="btn bad" data-score="0" data-interlude="2" data-next="outcome">Reject the flame</button>
          </div>
        </div>

        <!-- INTERLUDE (CROSSFADE) -->
        <figure class="interlude" id="interlude" aria-live="polite">
          <div class="frame">
            <img id="interlude-img" alt="" />
          </div>
          <figcaption class="bar">
            <div class="title" id="interlude-title">North Witch — Vision</div>
            <button id="continueBtn" class="btn primary">Continue</button>
          </figcaption>
        </figure>

        <!-- OUTCOME -->
        <div class="bubble" id="outcome" style="display:none">
          <h2 id="outcome-title">—</h2>
          <p id="outcome-text" class="note"></p>
          <div class="opts" id="again" style="display:none">
            <button class="btn" onclick="location.reload()">Walk the Rite Again</button>
            <a class="btn discord" href="https://discord.gg/u856NrVGjd" target="_blank" rel="noopener noreferrer">Return to Discord</a>
          </div>
        </div>

        <!-- FLEE -->
        <div class="bubble" id="flee" style="display:none">
          <h2>Retreat</h2>
          <p class="note">You turn from the auroras. The path collapses into frost. The Witch forgets your name.</p>
          <div class="opts">
            <button class="btn" onclick="location.reload()">Return to the Gate</button>
            <a class="btn discord" href="https://discord.gg/u856NrVGjd" target="_blank" rel="noopener noreferrer">Return to Discord</a>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="grid"><div class="center">
        <span class="tag">Tip: use <span class="kbd">Tab</span> + <span class="kbd">Enter</span>. Press <span class="kbd">R</span> to restart.</span>
      </div></div>
    </footer>
  </div>

  <script>
  (()=>{
    /* --------- helpers --------- */
    function basePath(){const p=location.pathname;return p.endsWith('/')?p:p.replace(/[^\/]+$/,'');}
    const BASE=basePath();
    const path=f=>BASE+f;

    /* --------- exact filenames (mapped to your images) --------- */
    const HERO_SRC = path("intro.jpg"); // Hero — Warrior Above the Burning City
    const VISIONS = [
      {src:path("north1.jpg"), label:"North Witch — First Visage (Memory)"},
      {src:path("north2.jpg"), label:"North Witch — Second Visage (Flesh)"},
      {src:path("north3.jpg"), label:"North Witch — Third Visage (Fire)"}
    ];

    /* --------- nodes --------- */
    const bar=document.getElementById('bar');
    const hero=document.getElementById('hero');
    const heroNext=document.getElementById('heroNext');
    const interlude=document.getElementById('interlude');
    const interludeImg=document.getElementById('interlude-img');
    const interludeTitle=document.getElementById('interlude-title');
    const continueBtn=document.getElementById('continueBtn');

    let score=0, stepsDone=0, stepsTotal=3, queuedNext=null;

    /* --------- preload --------- */
    function preload(src){return new Promise(res=>{const im=new Image();im.onload=()=>res(true);im.onerror=()=>res(false);im.src=src;});}
    (async()=>{
      await preload(HERO_SRC);
      hero.src=HERO_SRC;
      show('welcome');
      // warm the visions
      VISIONS.forEach(v=>preload(v.src));
    })();

    /* --------- bubble show/hide with fade --------- */
    function show(id){
      document.querySelectorAll('.bubble').forEach(b=>{
        b.style.display = b.id === id ? 'block' : 'none';
        if(b.id === id){ requestAnimationFrame(()=>b.classList.add('show')); }
        else { b.classList.remove('show'); }
      });
      interlude.style.display='none';
    }
    function progress(){ stepsDone=Math.min(stepsTotal,stepsDone+1); bar.style.width=Math.round((stepsDone/stepsTotal)*100)+'%'; }

    /* --------- crossfade util for hero & interludes --------- */
    function crossfadeHero(nextSrc, nextAlt=""){
      heroNext.src = nextSrc;
      heroNext.alt = nextAlt;
      // swap opacities
      hero.classList.add('fade-out');
      heroNext.classList.add('fade-in');
      setTimeout(()=>{
        hero.src = nextSrc;
        hero.alt = nextAlt;
        hero.classList.remove('fade-out');
        heroNext.classList.remove('fade-in');
        heroNext.src = ""; // free memory
      }, 900);
    }

    function showInterlude(index, nextId){
      const v = VISIONS[index] || VISIONS[0];
      interludeImg.classList.remove('show');
      interludeImg.src = v.src;
      interludeImg.alt = v.label;
      interludeTitle.textContent = v.label;
      interlude.style.display='block';
      // crossfade hero behind the scenes for extra mood
      crossfadeHero(v.src, v.label);
      // reveal interlude image after minimal delay to get the fade
      setTimeout(()=>interludeImg.classList.add('show'), 30);
      queuedNext = nextId;
      interlude.scrollIntoView({behavior:'smooth',block:'center'});
    }

    function renderOutcome(){
      const title=document.getElementById('outcome-title');
      const text=document.getElementById('outcome-text');
      const again=document.getElementById('again');
      if(score>=2){
        title.textContent='Branding at the Northern Ward';
        text.innerHTML='You endured the three shades. The North Witch presses a burning sigil to your skin. You are bound as <b>Firewall Acolyte</b>. The Shield stands.';
      } else {
        title.textContent='Frostfall';
        text.textContent='The fire would not take. The auroras dim. Return when the core is ready.';
      }
      again.style.display='flex';
    }

    /* --------- wiring --------- */
    continueBtn.addEventListener('click', ()=>{
      if(!queuedNext) return;
      if(['mem','flesh','fire'].includes(queuedNext) || queuedNext==='outcome') progress();
      show(queuedNext);
      if(queuedNext==='outcome') renderOutcome();
      queuedNext=null;
    });

    document.querySelectorAll('.btn[data-next]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        score += Number(btn.dataset.score||0);
        const next = btn.dataset.next;
        const il   = Number(btn.dataset.interlude||0);
        // hide current bubble smoothly
        const parent = btn.closest('.bubble'); 
        if(parent){ parent.classList.remove('show'); setTimeout(()=>{ parent.style.display='none'; }, 150); }
        showInterlude(il, next);
      });
    });

    document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='r') location.reload(); });
  })();
  </script>
</body>
</html>
